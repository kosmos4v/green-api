{"ast":null,"code":"import { call, put, select } from 'typed-redux-saga';\nimport { takeEvery } from 'redux-saga/effects';\nimport { SEND_MESSAGE, sendMessagePending, sendMessageSuccess, sendMessageFailure, RECEIVE_NOTIFICATION, receiveNotificationPanding } from '../actions/chat';\nimport { apiSendMessage, apiReceiveNotification } from '../../api';\nfunction sendMessage(_ref) {\n  let {\n    payload\n  } = _ref;\n  return function* () {\n    try {\n      yield put(sendMessagePending(true));\n      const {\n        idMessage\n      } = yield* call(apiSendMessage, payload.phone, payload.currentMessage, payload.userId);\n      if (idMessage) {\n        yield put(sendMessageSuccess(idMessage, payload.currentMessage, payload.phone));\n      }\n      ;\n    } catch (e) {\n      yield put(sendMessageFailure('Не удалось отправить сообщение'));\n    } finally {\n      yield put(sendMessagePending(false));\n    }\n  }();\n}\n;\nfunction* receiveNotification() {\n  try {\n    yield put(receiveNotificationPanding(true));\n    // const userId = yield select(({ user }) => user.userId);\n    const {\n      userId\n    } = select(state => state.user);\n    const notification = yield* call(apiReceiveNotification, userId);\n  } catch (e) {} finally {}\n}\n;\nexport default function* chatSaga() {\n  yield takeEvery(SEND_MESSAGE, sendMessage);\n  yield takeEvery(RECEIVE_NOTIFICATION, receiveNotification);\n}","map":{"version":3,"names":["call","put","select","takeEvery","SEND_MESSAGE","sendMessagePending","sendMessageSuccess","sendMessageFailure","RECEIVE_NOTIFICATION","receiveNotificationPanding","apiSendMessage","apiReceiveNotification","sendMessage","_ref","payload","idMessage","phone","currentMessage","userId","e","receiveNotification","state","user","notification","chatSaga"],"sources":["/Users/valeriykasmasov/projects/green-api-test/src/redux/sagas/chat.ts"],"sourcesContent":["import { call, put, select } from 'typed-redux-saga';\nimport { takeEvery } from 'redux-saga/effects';\nimport { Action } from 'redux-actions';\n\nimport {\n    SEND_MESSAGE,\n    sendMessagePending,\n    sendMessageSuccess,\n    sendMessageFailure,\n    RECEIVE_NOTIFICATION,\n    receiveNotificationPanding,\n} from '../actions/chat';\nimport { TMessage } from '../../models/message';\nimport { apiSendMessage, apiReceiveNotification } from '../../api';\nimport { TRootState } from '../reducers';\n\nfunction* sendMessage({ payload }: Action<{ phone: string, currentMessage: TMessage, userId: string}>) {\n  try {\n    yield put(sendMessagePending(true));\n    const { idMessage } = yield* call(apiSendMessage, payload.phone, payload.currentMessage, payload.userId);\n    if (idMessage) {\n        yield put(sendMessageSuccess(idMessage, payload.currentMessage, payload.phone))};\n  } catch (e) {\n      yield put(sendMessageFailure('Не удалось отправить сообщение'));\n  } finally {\n      yield put(sendMessagePending(false));\n  }\n};\n\nfunction* receiveNotification ():Generator {\n  try {\n    yield put(receiveNotificationPanding(true));\n    // const userId = yield select(({ user }) => user.userId);\n    const {userId} = select((state: TRootState) => state.user);\n    const notification = yield* call(apiReceiveNotification, userId);\n  } catch (e) {\n\n  }finally {\n\n  }\n};\n\nexport default function* chatSaga () {\n    yield takeEvery(SEND_MESSAGE, sendMessage);\n    yield takeEvery(RECEIVE_NOTIFICATION, receiveNotification);\n}"],"mappings":"AAAA,SAASA,IAAI,EAAEC,GAAG,EAAEC,MAAM,QAAQ,kBAAkB;AACpD,SAASC,SAAS,QAAQ,oBAAoB;AAG9C,SACIC,YAAY,EACZC,kBAAkB,EAClBC,kBAAkB,EAClBC,kBAAkB,EAClBC,oBAAoB,EACpBC,0BAA0B,QACvB,iBAAiB;AAExB,SAASC,cAAc,EAAEC,sBAAsB,QAAQ,WAAW;AAGlE,SAAUC,WAAWA,CAAAC,IAAA;EAAA,IAAC;IAAEC;EAA4E,CAAC,GAAAD,IAAA;EAAA,oBAAE;IACrG,IAAI;MACF,MAAMZ,GAAG,CAACI,kBAAkB,CAAC,IAAI,CAAC,CAAC;MACnC,MAAM;QAAEU;MAAU,CAAC,GAAG,OAAOf,IAAI,CAACU,cAAc,EAAEI,OAAO,CAACE,KAAK,EAAEF,OAAO,CAACG,cAAc,EAAEH,OAAO,CAACI,MAAM,CAAC;MACxG,IAAIH,SAAS,EAAE;QACX,MAAMd,GAAG,CAACK,kBAAkB,CAACS,SAAS,EAAED,OAAO,CAACG,cAAc,EAAEH,OAAO,CAACE,KAAK,CAAC,CAAC;MAAA;MAAC;IACtF,CAAC,CAAC,OAAOG,CAAC,EAAE;MACR,MAAMlB,GAAG,CAACM,kBAAkB,CAAC,gCAAgC,CAAC,CAAC;IACnE,CAAC,SAAS;MACN,MAAMN,GAAG,CAACI,kBAAkB,CAAC,KAAK,CAAC,CAAC;IACxC;EACF,CAAC;AAAA;AAAA;AAED,UAAUe,mBAAmBA,CAAA,EAAc;EACzC,IAAI;IACF,MAAMnB,GAAG,CAACQ,0BAA0B,CAAC,IAAI,CAAC,CAAC;IAC3C;IACA,MAAM;MAACS;IAAM,CAAC,GAAGhB,MAAM,CAAEmB,KAAiB,IAAKA,KAAK,CAACC,IAAI,CAAC;IAC1D,MAAMC,YAAY,GAAG,OAAOvB,IAAI,CAACW,sBAAsB,EAAEO,MAAM,CAAC;EAClE,CAAC,CAAC,OAAOC,CAAC,EAAE,CAEZ,CAAC,SAAQ,CAET;AACF;AAAC;AAED,eAAe,UAAUK,QAAQA,CAAA,EAAI;EACjC,MAAMrB,SAAS,CAACC,YAAY,EAAEQ,WAAW,CAAC;EAC1C,MAAMT,SAAS,CAACK,oBAAoB,EAAEY,mBAAmB,CAAC;AAC9D"},"metadata":{},"sourceType":"module","externalDependencies":[]}